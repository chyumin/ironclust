# Ironclust Docker

This folder contains files to build a Docker Image that runs matlab implemented ironclust sorter


## Pre steps
No action is required in this section, the only purpose is to show how the p\_ironclust file (used by Dockerfile) was generated.

### Matlab Requirements
- JSONLab toolbox
- MATLAB Compiler
- Statistics and Machine Learning Toolbox
- Signal Processing Toolbox
- Image Processing Toolbox

### Steps to generate the irc2 compiled file
- Open Matlab 
- Set Matlab's workspace folder to be in the following folder: `ironclust/matlab`
- Open Matlab's `Application Compiler`
- Click `Open Project`
- Select `p_ironclust.prj` file
- Click on `Package` button
- The full path for compiled ironclust file is: `ironclust/matlab/irc2\_compiler/for\_redistribution\_files\_only/irc2`
- In matlab console run: `compiler.package.docker('p_ironclust', 'requiredMCRProducts.txt', 'ImageName', 'p_ironclust')`


## Files

- `p_ironclust` is a compiled file from `p_ironclust.m` via Matlab Compiler to run ironclust sorter, some files (probe, configs etc) are also embeded in compilation

- `Dockerfile` is a customized version of Dockerfile generated by the following matlab compiler command: `compiler.package.docker('p_ironclust', 'requiredMCRProducts.txt', 'ImageName', 'p_ironclust')`


## Building the image

To build the image run:

```
docker build -t spikeinterface/ironclust .
```

PS: The Docker Image starts from `matlabruntime/r2021b/release/update2/c0130000000000000` as base, this image is (probably) generated by Matlab Compiler

## Pull the image

Currently the image is pushed in `chyumin` dockerhub profile, it'll be changed to spikeinterface in the future

```
docker pull chyumin/ironclust
```

## Running the container

```
docker run -v <host-data-folder>:<docker-data-folder> -it chyumin/ironclust p_ironclust [ARGS]
```

Sample run:
```
docker run -v /opt/data:/opt/data -it chyumin/ironclust p_ironclust /opt/data/raw.mda /opt/data/geom.csv '' '' /opt/data/tmp/firing.mda /opt/data/argfile.txt
``` 

